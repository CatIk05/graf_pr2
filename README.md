# Инструмент визуализации графа зависимостей пакетов

Инструмент для анализа и визуализации зависимостей пакетов Ubuntu (APT) без использования менеджеров пакетов или сторонних библиотек для получения зависимостей.

## Установка

```bash
# Python 3.7+ требуется
python3 --version

# Установка зависимостей (если потребуются)
pip3 install -r requirements.txt
```

## Конфигурация

Все настройки приложения хранятся в файле `config.json`:

### Параметры конфигурации:

- **`package_name`** (строка, обязательно) - имя анализируемого пакета
  - Пример: `"firefox"`, `"python3"`, `"gcc"`

- **`repository_url`** (строка, обязательно) - URL-адрес репозитория APT
  - Должен начинаться с `http://` или `https://`
  - Пример: `"http://archive.ubuntu.com/ubuntu/dists/jammy/main/binary-amd64/Packages"`

- **`test_mode`** (boolean, обязательно) - режим работы с тестовым репозиторием
  - `true` - использовать локальный тестовый файл
  - `false` - использовать URL реального репозитория

- **`test_repository_path`** (строка) - путь к файлу тестового репозитория
  - Используется только когда `test_mode: true`
  - Должен быть валидным путем к существующему файлу
  - Пример: `"./test_repo.txt"`

- **`output_file`** (строка, обязательно) - имя сгенерированного файла с изображением графа
  - Должно иметь расширение: `.svg`, `.png`, `.pdf` или `.dot`
  - Пример: `"dependency_graph.svg"`

- **`filter_substring`** (строка) - подстрока для фильтрации пакетов
  - Пакеты, содержащие эту подстроку, будут исключены из анализа
  - Может быть пустой строкой `""`
  - Пример: `"lib"`, `"dev"`

### Пример конфигурации:

```json
{
  "package_name": "firefox",
  "repository_url": "http://archive.ubuntu.com/ubuntu/dists/jammy/main/binary-amd64/Packages",
  "test_mode": false,
  "test_repository_path": "",
  "output_file": "dependency_graph.svg",
  "filter_substring": ""
}
```

## Использование

### Основные команды

#### 1. Запуск приложения

```bash
# Запуск с конфигурацией по умолчанию (config.json)
python3 main.py

# Или если файл исполняемый
./main.py
```

**Что происходит при запуске:**
- Загружается и валидируется конфигурация из `config.json`
- Выводятся все параметры конфигурации в формате ключ-значение
- Выполняется основная логика приложения (зависит от этапа разработки)

**Пример вывода:**
```
=== Параметры конфигурации ===
package_name: firefox
repository_url: http://archive.ubuntu.com/ubuntu/dists/jammy/main/binary-amd64/Packages
test_mode: false
test_repository_path: (пусто)
output_file: dependency_graph.svg
filter_substring: (пусто)
===================================

Конфигурация успешно загружена!
Анализируемый пакет: firefox
Режим тестирования: выключен
```

#### 2. Тестирование обработки ошибок

```bash
# Демонстрация всех типов ошибок валидации
python3 test_error_handling.py
```

Этот скрипт проверяет обработку ошибок для всех параметров конфигурации:
- Отсутствующие обязательные поля
- Неправильные типы данных
- Недопустимые значения
- Некорректный формат JSON
- Отсутствующие файлы

### Работа с конфигурацией

#### Редактирование конфигурации

```bash
# Открыть файл конфигурации в редакторе
nano config.json
# или
vim config.json
# или любой другой редактор
```

#### Проверка синтаксиса JSON

```bash
# Проверить корректность JSON файла
python3 -m json.tool config.json > /dev/null && echo "JSON валиден" || echo "Ошибка в JSON"
```

#### Создание альтернативных конфигураций

Вы можете создать несколько файлов конфигурации и использовать их:

```bash
# Создать копию конфигурации
cp config.json config_test.json

# Отредактировать config_test.json

# Использовать другую конфигурацию (требует изменения кода)
# или просто заменить config.json
cp config_test.json config.json
```

### Примеры использования

#### Пример 1: Анализ пакета Firefox (реальный репозиторий)

```json
{
  "package_name": "firefox",
  "repository_url": "http://archive.ubuntu.com/ubuntu/dists/jammy/main/binary-amd64/Packages",
  "test_mode": false,
  "test_repository_path": "",
  "output_file": "firefox_dependencies.svg",
  "filter_substring": ""
}
```

```bash
python3 main.py
```

#### Пример 2: Режим тестирования с локальным файлом

```json
{
  "package_name": "PACKAGE_A",
  "repository_url": "",
  "test_mode": true,
  "test_repository_path": "./test_repository.txt",
  "output_file": "test_graph.svg",
  "filter_substring": ""
}
```

```bash
# Убедитесь, что файл test_repository.txt существует
python3 main.py
```

#### Пример 3: Анализ с фильтрацией пакетов

```json
{
  "package_name": "python3",
  "repository_url": "http://archive.ubuntu.com/ubuntu/dists/jammy/main/binary-amd64/Packages",
  "test_mode": false,
  "test_repository_path": "",
  "output_file": "python3_dependencies.svg",
  "filter_substring": "lib"
}
```

Это исключит все пакеты, содержащие "lib" в имени.

### Обработка ошибок

Приложение обрабатывает следующие типы ошибок:

1. **Файл конфигурации не найден**
   ```
   Ошибка конфигурации: Конфигурационный файл 'config.json' не найден
   ```

2. **Некорректный JSON**
   ```
   Ошибка конфигурации: Ошибка парсинга JSON: ...
   ```

3. **Отсутствующие обязательные поля**
   ```
   Ошибка конфигурации: Отсутствуют обязательные поля: package_name
   ```

4. **Неправильный тип данных**
   ```
   Ошибка конфигурации: Поле 'package_name' должно быть строкой
   ```

5. **Пустые обязательные поля**
   ```
   Ошибка конфигурации: Поле 'package_name' не может быть пустым
   ```

6. **Недопустимые значения**
   ```
   Ошибка конфигурации: Поле 'repository_url' должно быть валидным URL
   Ошибка конфигурации: Поле 'output_file' должно иметь расширение .svg, .png, .pdf или .dot
   ```

7. **Ошибки режима тестирования**
   ```
   Ошибка конфигурации: При включенном режиме тестирования поле 'test_repository_path' не может быть пустым
   Ошибка конфигурации: Тестовый файл репозитория '...' не найден
   ```

### Структура проекта

```
pr2/
├── main.py                 # Основной скрипт приложения
├── config.json             # Файл конфигурации
├── test_error_handling.py  # Скрипт для тестирования обработки ошибок
├── README.md               # Документация
├── requirements.txt        # Зависимости проекта
└── .gitignore             # Игнорируемые файлы Git
```

### Проверка работы

```bash
# 1. Проверить синтаксис Python
python3 -m py_compile main.py

# 2. Запустить приложение
python3 main.py

# 3. Протестировать обработку ошибок
python3 test_error_handling.py

# 4. Проверить статус Git
git status
```

## Этапы разработки

- [x] Этап 1: Минимальный прототип с конфигурацией
- [ ] Этап 2: Сбор данных
- [ ] Этап 3: Основные операции
- [ ] Этап 4: Дополнительные операции
- [ ] Этап 5: Визуализация

